[TOC]

# 第九章 计算机算数

## KEY POINTS

> **1、算术逻辑单元的结构与功能**
>
> **2、整数的表示，包括无符号数的表示以及有符号数的原码、反码、补码和真值的关系与转换**
>
> **3、整数运算，整数的扩展，整数的取反方式，原码整数的加减运算，补码数的加减运算，溢出的概念与判别方式**
>
> **4、浮点数的表示与运算，浮点数的规格化表示，浮点数的精度和范围的关系，<mark>计算搞懂PPT就行</mark>**

## 9.1 算术逻辑单元

算术逻辑单元ALU是计算机实际算术逻辑运算的部件

数据由寄存器提交给ALU，运算结果页存放于ALU，控制器提供控制ALU操作和数据传入送出ALU的信号；ALU根据运算结果会设置一些标志

<img src="https://raw.githubusercontent.com/yijunquan-afk/img-bed-1/main/img2/1695704214.png" alt="image-20211029114453258" style="zoom: 67%;" />

## 9.2 整数表示

只有0和1代表一切，以二进制存储的数

n位二进制数字an-1an-2....a1a0表示无符号整数A<img src="https://raw.githubusercontent.com/yijunquan-afk/img-bed-1/main/img2/1695704215.png" alt="image-20211226115848169" style="zoom:50%;" />

### 符号-幅值表示法|Sign-Magnitude Representation

最左边的位是符号位

> 0意味着正数、1意味着负数
>

+18 = 00010010	-18 = 10010010

**问题**

> 在算术中需要同时考虑符号和大小
>
> 0的两种表示(+0和-0)
>
> 很少使用

原码、补码、反码

### 2的补码表示法|Two’s Complement Representation

正数补码=无符号数

负数的补码=按位取反无符号数+1

![image-20211226120558442](https://raw.githubusercontent.com/yijunquan-afk/img-bed-1/main/img2/1695704191.png)

![image-20211226120749843](https://raw.githubusercontent.com/yijunquan-afk/img-bed-1/main/img2/1695704193.png)

![image-20211226122201094](https://raw.githubusercontent.com/yijunquan-afk/img-bed-1/main/img2/1695704194.png)

#### 取值范围

8 bit 2’s complement

> $+127 = 01111111 = 2^7 -1$
>
> $-128 = 10000000= -2^7$

16 bit 2s complement

> $+32767 = 011111111 11111111 = 2^{15} - 1$
>
> $-32768 = 100000000 00000000 = -2^{15}$

#### 优点

零只有一种表示

计算简便

取反是相当容易的

## 9.3 整数运算

### 取反

原码表示 ：符号位取反

补码表示：对该数补码的所有位（包括符号位）取反

3 = 00000011

> 取反+1=11111100+1=11111101=-3

-3=11111101

> 取反+1=00000010+1=00000011=3

需要注意的是n位二进制补码数A的范围是 $[-2^{n-1}，2^{n-1}-1]$，所以对数值为-2n-1的数取负时要先扩展至少1位才能按规则取负

### 加减法

加法规则：普通二进制加法

注意计算结果是否溢出

> 溢出规则：**若两个正数或两个负数相加，当且仅当结果的符号位变反时，发生溢出**

减法规则：对减数取负(求补)，并把它加到被减数上

> a - b = a + (-b)
>
> 减法可用加法器实现
>
> 溢出规则同加法
>
> 计算机中没有减法器
>
> 只需要加法器和求补器

![image-20211226123644927](https://raw.githubusercontent.com/yijunquan-afk/img-bed-1/main/img2/1695704195.png)

![image-20211226123926286](https://raw.githubusercontent.com/yijunquan-afk/img-bed-1/main/img2/1695704197.png)

### 乘法【了解】

#### 无符号数

![image-20211226124034121](https://raw.githubusercontent.com/yijunquan-afk/img-bed-1/main/img2/1695704198.png)

**这种算法的困难**

将多个部分积一次全部相加，机器难以实现

对于每一个部分积都需要存储，而且最后乘积位数增加了一倍，这就会造成器件的浪费和运算时间的增加

![image-20211226124646281](https://raw.githubusercontent.com/yijunquan-afk/img-bed-1/main/img2/1695704199.png)

![image-20211226124917277](https://raw.githubusercontent.com/yijunquan-afk/img-bed-1/main/img2/1695704200.png)



#### 补码表示

![image-20211226125106673](https://raw.githubusercontent.com/yijunquan-afk/img-bed-1/main/img2/1695704201.png)

![image-20211226125148003](https://raw.githubusercontent.com/yijunquan-afk/img-bed-1/main/img2/1695704202.png)

### 除法【了解】

![image-20211226125437443](https://raw.githubusercontent.com/yijunquan-afk/img-bed-1/main/img2/1695704203.png)

补码转换为无符号数计算即可，注意符号位

## 9.4 浮点数表示法

### 表示原理

$$
±S×B^{±E}
$$

符号位：0正，1负

B：指数的底或基是隐含的，二进制数基为2不需要存储

S：有效数,小数点位置为最高位有效位的右边，即小数点左边有1位有效数。对于二进制数，有效数的小数点前只能是1，所以从小数点后开始存储有效数以节省存储空间

E：指数或者阶

实际上使用了移码
$$
±S×B^{E^{'}}
$$
存储的指数值E’为移码，是无符号数,存储的指数值 = 真正的指数 + 偏移量(目的：正数方便比较)

通常，偏移量等于$2^{k-1}-1$,k：二进制指数的位数

> 一个8位字段，取偏移量为127
>
> 真实指数的范围是 [-127，128]
>
> 存储指数的范围是 [0，255]

![image-20211226143852829](https://raw.githubusercontent.com/yijunquan-afk/img-bed-1/main/img2/1695704205.png)

**由于小数点位置不固定，这种指数表示的浮点数应该有多种样式**

为了简化浮点数操作，浮点数通常需要规格化

规格化方法是在小数点前只保留一位数字，并调整指数以保证有效值的最高有效数位为1

![image-20211226144102932](https://raw.githubusercontent.com/yijunquan-afk/img-bed-1/main/img2/1695704206.png)



> 比$-(2-2^{-23})\times 2^{128}$还小的负数，叫做**负上溢（negative overflow）**。
> 比$-2^{-127}$还大的负数，叫做**负下溢(negative underflow)**。
> 零。
> 比$2^{-127}$还小的正数，叫做**正下溢（positive underflow**）。
> 比$(2-2^{-23})\times 2^{128}$还大的正数，叫做**正上溢**

对于一个32位数，8位用于指数，23位用于有效数

表示范围：$+/- 2^{128} ≈ 3.4 \times 10^{38}$

精确度：$2^{-23} ≈ 1.2 \times10^{-7}$

> 当增加指数位数时，可以扩大所表示数的范围，但会导致精度降低，反之亦然
>
> 需要在表示范围和精度之间进行权衡

### 算术运算

​    对于加法和减法运算，必须要保证两个操作数有着相同的指数, 而乘法和除法就相对简单很多

![image-20211226145339805](https://raw.githubusercontent.com/yijunquan-afk/img-bed-1/main/img2/1695704208.png)

浮点数运算可能会存在的一些特殊情况

> **指数上溢Exponent overflow**：数值太大超过可表示的范围，问题严重需要报告
>
> **指数下溢Exponent underflow**：数值太小超过可表示范围，一般设为0
>
> **有效数下溢Significant underflow**：有效数对齐时，有数字从右边移出丢失，需要舍入
>
> **有效数上溢Significant overflow**：同符号数相加时导致有效位的进位，使得小数点前有两位有效数，需要通过增加指数，右移有效数来重新进行规格化

**下溢的问题比较小，上溢问题大**

#### 加减法

**浮点运算加法和减法运算过程**

:one: 检查0

:two: 对齐指数

:three: 重复右移较小操作数，直到指数相同：一旦溢出发生，造成的影响较小

:four: 加或减有效值

:five: 规格化结果

![image-20211226150242283](https://raw.githubusercontent.com/yijunquan-afk/img-bed-1/main/img2/1695704209.png)

#### 乘除法

![image-20211226150150265](https://raw.githubusercontent.com/yijunquan-afk/img-bed-1/main/img2/1695704211.png)

![image-20211226150300180](https://raw.githubusercontent.com/yijunquan-afk/img-bed-1/main/img2/1695704212.png)



## 9.5 IEEE 754 Formats

![image-20211226150612722](https://raw.githubusercontent.com/yijunquan-afk/img-bed-1/main/img2/1695704213.png)

| 类别                                    | 正负号 | 实际指数 | 有偏移指数 | 指数域    | 尾数域                       | 数值                 |
| --------------------------------------- | ------ | -------- | ---------- | --------- | ---------------------------- | -------------------- |
| 零                                      | 0      | -127     | 0          | 0000 0000 | 000 0000 0000 0000 0000 0000 | 0.0                  |
| 负零                                    | 1      | -127     | 0          | 0000 0000 | 000 0000 0000 0000 0000 0000 | −0.0                 |
| 1                                       | 0      | 0        | 127        | 0111 1111 | 000 0000 0000 0000 0000 0000 | 1.0                  |
| -1                                      | 1      | 0        | 127        | 0111 1111 | 000 0000 0000 0000 0000 0000 | −1.0                 |
| 最小的非规约数                          | *      | -127     | 0          | 0000 0000 | 000 0000 0000 0000 0000 0001 | ±2× 2= ±2≈ ±1.4×10   |
| 中间大小的非规约数                      | *      | -127     | 0          | 0000 0000 | 100 0000 0000 0000 0000 0000 | ±2× 2= ±2≈ ±5.88×10  |
| 最大的非规约数                          | *      | -127     | 0          | 0000 0000 | 111 1111 1111 1111 1111 1111 | ±(1−2) × 2≈ ±1.18×10 |
| 最小的规约数                            | *      | -126     | 1          | 0000 0001 | 000 0000 0000 0000 0000 0000 | ±2≈ ±1.18×10         |
| 最大的规约数                            | *      | 127      | 254        | 1111 1110 | 111 1111 1111 1111 1111 1111 | ±(2−2) × 2≈ ±3.4×10  |
| 正无穷                                  | 0      | 128      | 255        | 1111 1111 | 000 0000 0000 0000 0000 0000 | +∞                   |
| 负无穷                                  | 1      | 128      | 255        | 1111 1111 | 000 0000 0000 0000 0000 0000 | −∞                   |
| [NaN](https://baike.baidu.com/item/NaN) | *      | 128      | 255        | 1111 1111 | non zero                     | NaN                  |
| * 符号位可以为0或1.                     |        |          |            |           |                              |                      |

​                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        