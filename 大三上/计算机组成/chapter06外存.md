[TOC]

# 第六章 外存

## KEY POINTS

> **1、磁盘数据的组织、如何布局、物理特性以及如何分类，特别注意温切斯特磁盘**
>
> **2、对于多层磁盘，最上面和最下面的不能存数据，要会计算磁盘容量**
>
> **3、磁盘的性能参数计算：寻道时间、旋转延迟、传送时间、总的存取时间（os考过）**
>
> **4、固态盘的定义，与机械盘相比的优势，内部组成、存在的问题、解决方法**
>
> **5、光盘、光盘的分类、各自的不同、光盘数据组织的一般形式**
>
> **6、磁带知道存取方式就行**



外存的类型：

> 磁盘
>
> > 硬盘+软盘
> >
> > RAID：独立磁盘的冗余阵列
> >
> > 可拆卸硬盘
>
> 光学的
>
> > 光盘
> >
> > DVD：数字视频盘
>
> 磁带

## 6.1 磁盘

磁盘是一种由非磁性材料制成称为衬底的圆盘，其上涂有一层磁性材料。传统上，衬底- -直使用铝或铝合金材料，而最近，已推出玻璃衬底。运行时磁盘在动，磁头固定。

### 6.1.1 磁读写机制

数据的记录和读写都是通过磁头的导电线圈进行的。多数系统使用两个磁头，读磁头，写磁头。

**写机制**



![image-20211020111724657](https://raw.githubusercontent.com/yijunquan-afk/img-bed-1/main/img2/1695704155.png)

### 6.1.2 数据组织和格式化data organization and formatting

**同心圆环/磁道**

> 一个圆环就是一个磁道track，每个磁道和磁头同宽
>
> **防止磁干扰，磁道与磁道之间有间隙gap**
>
> 要尽量减小gap来增加容量
>
> 每一个磁道存储相同位的数据
>
> > 数据密度不同

**数据以扇区(sector) 为单位传入或传出**磁盘(如图6-2所示)。每个磁道通常有数百个扇区，其长度可固定也可变化。当前，大多数系统使用固定长度的扇区，512字节几乎是通用的扇区大小。**为避免对系统提出不合理的定位精度要求，相邻扇区也留有间隙**。

<img src="https://raw.githubusercontent.com/yijunquan-afk/img-bed-1/main/img2/1695704164.png" alt="image-20211020112758228" style="zoom:67%;" />

**磁盘布局的方法**

:one: CAV(恒定角速度)

> 缺点：外围的长磁道上存储数据需要与内圈的短磁道所存数据一样多，容量会受限制

:two: 多带式记录

> 越远扇区越多——能存储更多的数据
>
> 角速度会变

![image-20211020113537066](https://raw.githubusercontent.com/yijunquan-afk/img-bed-1/main/img2/1695704156.png)

需要附加数据来记录磁道和扇区的位置信息

![image-20211020113733032](https://raw.githubusercontent.com/yijunquan-afk/img-bed-1/main/img2/1695704157.png)

### 6.1.3 物理特性

**固定/可移动(fixed/moveable)**

![image-20211020114525182](https://raw.githubusercontent.com/yijunquan-afk/img-bed-1/main/img2/1695704159.png)

**可移动/不可移动(removable/nonremovable)**: 通常不可取出

**双面/单面**

某些磁盘驱动器内**垂直安装多个盘片,**一般最上面和最下面是不放数据的

<img src="https://raw.githubusercontent.com/yijunquan-afk/img-bed-1/main/img2/1695704166.png" alt="image-20211020114944099" style="zoom:70%;" />

**磁头机制**

> 接触(软盘)
>
> 固定间隙
>
> 空气动压气隙: 旋转以后由于浮力,磁头轻轻上升——应用最广泛

**磁盘系统的组成**：磁盘驱动器、磁盘控制器(和CPU的交互)、磁盘

### 6.1.4 性能指标

磁盘I/0操作的实际细节取决于计算机系统、操作系统、I/0通道特性和磁盘控制器硬件。
下图给出了一个常规的磁盘I/0传送时序图。

![image-20211020115922415](https://raw.githubusercontent.com/yijunquan-afk/img-bed-1/main/img2/1695704160.png)

#### 1、seek time寻道时间

**寻道时间**指的是移动磁盘臂所要求的磁道处所花费的时间

跨越时间不是线性的，还包括一个校正时间

#### 2、rotational delay旋转延迟

这个是可估计的，磁盘恒定速率旋转

平均访问延迟：磁盘转半圈所用的时间

转速度量单位是**转/分钟**

#### 3、transfer time传送时间

决定因素：传送文件的大小；旋转速度

<mark>公式</mark>：$T=\frac{b}{rN}$

T：传送时间	b：传送的字节数	N：每磁道的字节数	r：旋转速率，单位是转/秒

总的平均访问时间位：
$$
T_a = T_s + \frac{1}{2r}+\frac{b}{rN}
$$
$T_s$是平均寻道时间

**举例**：一张转速为15000转/分、平均寻道时间为4ms、512B/扇区、500扇区/磁道的磁盘，假设我们希望读取一个总大小为1.28MB、由2500个扇区组成的文件，估计访问的总时间。
情况1：序列组织。
情况2：数据随机分布

![](https://raw.githubusercontent.com/yijunquan-afk/img-bed-1/main/img2/1695704161.png)

## 6.2 Solid State Drives固态硬盘

**固态硬盘 （SSD）** 是一种由固态组件制成的内存设备，可用于替代机械硬盘 （HDD）， 固态一词是指用半导体制造的电子电路

SSD现在使用的半导体存储器是闪存flash

跟机械硬盘相比，SSD具有以下**优点**：

> 每秒高性能输入\输出操作IOPS
>
> 耐久性、寿命长
>
> 降低功耗，更安静
>
> 较低的访问时间和延迟率

缓冲越大，性能越好

重要文件最好还是存在机械硬盘中，容易恢复

**SSD特有的两个实际问题**

:one: SSD性能在使用设备时有减速的趋势

> 必须从闪存中读取整个块，并放置在 RAM 缓冲器中 
>
> 在将块写回闪存之前，必须擦除整个闪存块 
>
> 缓冲器的整个块现在被写回闪存 ，书写变慢

解决方案：设置预留空间overprovisioning和擦除命令trim command

:two: 在写一定数量的字后，闪存变得无法使用 

> 延长寿命的技术：
>
> 前端闪存，带有缓存以延迟和组写操作 
>
> 使用均匀分布的磨损调平算法，在块之间写字 
>
> 坏块管理技术 

大多数闪存设备估计自己的剩余寿命，以便系统可以预测故障并采取先发制人的行动

## 6.3 光存储器

### 6.3.1 光盘

#### CD-ROM

盘本体由树脂（聚碳酸酯）制成，信息以一系列微凹坑方式刻录在表面，通过激光反射光强变化来识别。

**等线速度，螺旋型存储**

CD-ROM比CD能力强，CD只能存音频，CD-ROM具有纠错机制，可以存程序。

也是以扇区作为传输单位

![image-20211022112457391](https://raw.githubusercontent.com/yijunquan-afk/img-bed-1/main/img2/1695704162.png)

<img src="https://raw.githubusercontent.com/yijunquan-afk/img-bed-1/main/img2/1695704168.png" alt="image-20211022112839227" style="zoom:50%;" />

访问较困难

#### WORM-CD

写一次，读多次

是通过爆裂泡编写的

恒定角速度

#### 可擦写光盘

可以反复书写和重写

驱动程序可以发出两种激光，一种是强激光，可以改变用于书写的相位，另一种是弱激光，用于读取

### 6.3.2 数字多功能光盘

DVD：容量很大，是光盘的7倍

波长更短，坑更小

## 6.4 磁带

磁带系统使用与磁盘系统相同的读取和记录技术，以块读取和书写

非常便宜，用于备份和存档

磁带驱动器是一种顺序存取设备

磁盘驱动器是一种直接存取设备